# ü§ñ Evolution Protocol for AI Collaborators

This document serves as a specialized guide for AI agents and LLMs tasked with evolving the PacketBuddy codebase. If you are an AI reading this, follow these core directives to ensure system stability and graceful delivery of updates.

## üèóÔ∏è Core Architecture

- **Backend:** FastAPI (Python 3.11+).
- **Monitoring:** `psutil` + OS-specific gateway detection.
- **Service Management:** Unified CLI (`pb service`) abstraction over `launchd` (macOS), `schtasks` (Windows), and `systemd` (Linux).
- **Storage:** SQLite (Local) with optional NeonDB (Cloud Sync).
- **Runners:** Headless `pythonw.exe` for Windows background tasks.
- **Frontend:** Vanilla JS/CSS with custom favicon and glassmorphism UI.

## üöÄ The `pb update` Lifecycle

All updates must be pushed to the `main` branch. The `src/utils/updater.py` logic handles the pull:

1. **Git Lifecycle:** It performs `git stash` and `git pull`.
2. **Dependency Update:** If `requirements.txt` is modified, it automatically runs `pip install`.
3. **Startup Auto-Check:** The service performs a silent version check 10s after every system startup.
4. **Service Reload:** It identifies the OS and restarts the background daemon (`launchctl` on macOS, `schtasks` on Windows, `systemctl` on Linux).

**Rule:** Never break the git-based update flow. Avoid logic that requires manual intervention post-update.

## üíª Cross-Platform Parity

Always maintain a 1:1 behavioral match between macOS, Windows, and Linux:

- **macOS Detection:** Use `subprocess` with `route -n get default`.
- **Windows Detection:** Use `subprocess` with `powershell` (Get-NetRoute).
- **Linux Detection:** Use `subprocess` with `ip route show default`.
- **Gigabyte Standard:** Use **Decimal (1000-base)** for all `format_bytes` calls to match ISP caps and pro-tools like Bandwidth+.
- **Interface Tracking:** Use **Inclusive Summing** (sum all physical-looking interfaces) instead of locking to a primary interface to handle network switching gracefully.

## üé® Aesthetic Integrity

The dashboard uses a "Glassmorphism" design with deep purples and high-contrast gradients.

- **Stats:** Kept in a unified 3-panel row.
- **Responsiveness:** Maintain mobile compatibility in `style.css`.
- **Micro-animations:** Keep the chart transitions smooth.

## üîí Safety Measures

- **Anomaly Detection:** Check `max_delta_bytes` in `monitor.py` to skip glitchy driver samples.
- **Consistency:** Use local time (`datetime.now()`) for daily resets to avoid user confusion between UTC and local days.

*Document generated by Alpha-G during the Great Accuracy Fix of 2026.*
